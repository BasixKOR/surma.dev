<!DOCTYPE html>
<meta name="viewport" content="minimum-scale=1, width=device-width" />
<style>
  svg {
    width: 100%;
    height: auto;
  }
  .lens {
    stroke: hsla(240, 100%, 50%, 0.6);
    fill: hsla(240, 100%, 50%, 0.2);
  }
  .lensplane {
    stroke: hsla(0, 0%, 0%, 0.4);
    stroke-dasharray: 4 1;
  }
  .light {
    stroke-dasharray: 3 6;
    stroke: hsl(20deg 100% 60% / 76%);
    stroke-width: 3px;
    fill: hsl(20deg 100% 60% / 26%);
  }
</style>
<div id="target"></div>
<script>
  document.write(
    `  
    <script type="importmap">
      {
        "imports": {
          "lit1.3.0/": "/node_modules/lit1.3.0/"
        }
      }
    <` +
      `/script>
  `
  );
</script>
<script type="module">
  import {
    Lens,
    Segment,
    HalfSegment,
    Point,
    Polygon,
    instantiateDiagram,
  } from "./geometry.js";

  const { target } = document.all;

  const diagram = {
    width: 500,
    height: 300,
    viewBox: {
      leftX: -300,
      rightX: 200,
      topY: -150,
      bottomY: 150,
    },
    handles: {
      p: new Point(150, 20).setName("p"),
      fp: new Point(50, 0).setName("fp"),
    },
    recalculate() {
      this.handles.fp.y = 0;
      this.handles.p.x = Math.max(this.handles.p.x, this.handles.fp.x + 1);
      const lens = new Lens(new Point(0, 0), this.handles.fp, 150).addClass(
        "lens"
      );
      const lensplane = lens.asLine().addClass("lensplane");
      const { point, ray1a, ray1b, ray2a, ray2b } = lens.lensProject(
        this.handles.p
      );
      const top = lens.top();
      const bottom = lens.bottom();
      const light = new Polygon(
        this.handles.p,
        top,
        new HalfSegment(top, point).pointAtDistance(1000),
        new HalfSegment(bottom, point).pointAtDistance(1000),
        bottom
      ).addClass("light");
      return [ray1a, ray1b, ray2a, ray2b, lens, lensplane, light];
    },
  };

  instantiateDiagram(diagram, target);
</script>
