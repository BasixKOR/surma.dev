<!DOCTYPE html>
<style>
  [data-type="lens"] {
    stroke: hsla(240, 100%, 50%, 0.6);
    fill: hsla(240, 100%, 50%, 0.2);
  }
  .lensplane {
    stroke: hsla(0, 0%, 0%, 0.4);
    stroke-dasharray: 4 1;
  }
  .light {
    stroke-dasharray: 3 6;
    stroke: hsl(20deg 100% 60% / 76%);
    stroke-width: 3px;
  }
</style>
<div id="target"></div>
<script>
  document.write(
    `  
    <script type="importmap">
      {
        "imports": {
          "lit1.3.0/": "/node_modules/lit1.3.0/"
        }
      }
    <` +
      `/script>
  `
  );
</script>
<script type="module">
  import {
    Lens,
    Segment,
    HalfSegment,
    Point,
    Polygon,
    instantiateDiagram,
  } from "./geometry.js";

  const { target } = document.all;

  const diagram = {
    width: 500,
    height: 300,
    viewBox: {
      leftX: -250,
      rightX: 250,
      topY: -150,
      bottomY: 150,
    },
    handles: {
      p: new Point(200, 20).setName("p"),
      fp: new Point(50, 0).setName("fp"),
    },
    recalculate() {
      this.handles.fp.y = 0;
      const lens = new Lens(new Point(0, 0), this.handles.fp, 150);
      const lensplane = lens.asLine().addClass("lensplane");
      const { point, ray1a, ray1b, ray2a, ray2b } = lens.lensProject(
        this.handles.p
      );
      const light1a = new Segment(this.handles.p, lens.top()).addClass("light");
      const light1b = new HalfSegment(lens.top(), point).addClass("light");
      const light2a = new Segment(this.handles.p, lens.bottom()).addClass(
        "light"
      );
      const light2b = new HalfSegment(lens.bottom(), point).addClass("light");
      return [
        ray1a,
        ray1b,
        ray2a,
        ray2b,
        lens,
        lensplane,
        light1a,
        light1b,
        light2a,
        light2b,
      ];
    },
  };

  instantiateDiagram(diagram, target);
</script>
